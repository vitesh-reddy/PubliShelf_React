<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell Antique - PubliShelf</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body class="bg-gray-50">
    <nav class=" bg-white shadow-sm z-50 fixed w-full">
        <div class="sm:px-6 lg:px-8 text-gray-900">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/publisher/dashboard" class="flex items-center">
                        <i class="fas fa-arrow-left text-gray-600 mr-4"></i>
                        <span
                            class="text-transparent bg-clip-text text-2xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 ">PubliShelf</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="pt-16">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class=" rounded-xl bg-white shadow-md overflow-hidden">
                <div class="p-6 border-b">
                    <h1 class="text-2xl font-bold text-gray-900">Sell Antique Book</h1>
                    <p class="text-gray-500 mt-1">Create an auction for your antique book</p>
                </div>

                <form method="POST" action="/publisher/sell-antique" enctype="multipart/form-data"
                    class="p-6 space-y-6 animate-fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="text-gray-700 block text-sm font-medium">Book Title</label>
                            <input type="text" required name="title"
                                class="mt-1 px-2 py-1 block w-full rounded-lg border-gray-300 shadow-sm hover:shadow-md focus:outline-none focus:outline-purple-500">
                        </div>

                        <div>
                            <label class="text-gray-700 block text-sm font-medium">Author</label>
                            <input type="text" required name="author"
                                class="mt-1 px-2 py-1 block w-full rounded-lg border-gray-300 shadow-sm hover:shadow-md focus:outline-none focus:outline-purple-500">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea rows="4" required name="description"
                            class="border-gray-300 shadow-sm hover:shadow-md focus:outline-none focus:outline-purple-500 mt-1 px-2 py-1 block w-full rounded-lg"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="text-gray-700 block text-sm font-medium">Genre</label>
                            <select required
                                class="bg-white mt-1 px-2 py-1 block w-full rounded-lg border-gray-300 shadow-sm hover:shadow-md focus:outline-none focus:outline-purple-500"
                                name="genre">
                                <option disabled selected value="">Select Genre</option>
                                <option value="Fiction">Fiction</option>
                                <option value="Non-Fiction">Non-Fiction</option>
                                <option value="Mystery">Mystery</option>
                                <option value="Science Fiction">Science Fiction</option>
                                <option value="Romance">Romance</option>
                                <option value="Thriller">Thriller</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">Condition</label>
                            <select required
                                class="bg-white mt-1 px-2 py-1 block w-full rounded-lg border-gray-300 shadow-sm hover:shadow-md focus:outline-none focus:outline-purple-500"
                                name="condition">
                                <option disabled selected value="">Select Condition</option>
                                <option>Mint</option>
                                <option>Near Mint</option>
                                <option>Excellent</option>
                                <option>Very Good</option>
                                <option>Good</option>
                                <option>Fair</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Base Price (â‚¹)</label>
                            <input type="number" step="0.01" required name="basePrice"
                                class="mt-1 px-2 py-1 block w-full rounded-lg border-gray-300 shadow-sm hover:shadow-md outline-none focus:outline-purple-500">
                        </div>

                        <div>
                            <label class="font-medium block text-sm text-gray-700">Auction Start</label>
                            <input type="datetime-local" id="auctionStart" required name="auctionStart"
                                class="block w-full rounded-lg mt-1 px-2 py-1 border-gray-300 shadow-sm hover:shadow-md outline-none focus:outline-purple-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">Auction End</label>
                            <input type="datetime-local" id="auctionEnd" required name="auctionEnd"
                                class="mt-1 px-2 py-1 block w-full rounded-lg border-gray-300 shadow-sm hover:shadow-md outline-none focus:outline-purple-500">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Item Image</label>
                        <div
                            class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg">
                            <div class="text-center space-y-1">
                                <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl"></i>
                                <div class="flex text-sm text-gray-600">
                                    <label
                                        class="bg-white rounded-md relative cursor-pointer bg-white font-medium text-purple-600 hover:text-purple-500">
                                        <span>Upload Image</span>
                                        <input id="itemImage" name="itemImage" type="file" class="sr-only"
                                            accept="image/*" required>
                                    </label>
                                    <p class="pl-1">or drag and drop</p>
                                </div>
                                <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                            </div>
                        </div>
                    </div>

                    <div id="imagePreviewContainer1" class="mt-4 hidden">
                        <h4 class="text-gray-700 mb-2 text-sm font-medium">Item Image Preview:</h4>
                        <img id="imagePreview1" class="w-48 h-64 object-cover rounded-lg shadow-md"
                            alt="Uploaded Image Preview">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">Authentication Image</label>
                        <div
                            class="pb-6 border-2 border-gray-300 border-dashed rounded-lg mt-1 flex justify-center px-6 pt-5">
                            <div class="space-y-1 text-center">
                                <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl"></i>
                                <div class="flex text-sm text-gray-600">
                                    <label
                                        class="relative cursor-pointer bg-white rounded-md font-medium text-purple-600 hover:text-purple-500">
                                        <span>Upload Image</span>
                                        <input id="authenticationImage" name="authenticationImage" type="file"
                                            class="sr-only" accept="image/*" required>
                                    </label>
                                    <p class="pl-1">or drag and drop</p>
                                </div>
                                <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                            </div>
                        </div>
                    </div>

                    <div id="imagePreviewContainer2" class="mt-4 hidden">
                        <h4 class="mb-2 text-sm font-medium text-gray-700">Authentication Image Preview:</h4>
                        <img id="imagePreview2" class="w-48 h-64 object-cover rounded-lg shadow-md"
                            alt="Uploaded Image Preview">
                    </div>

                    <div class="flex justify-end space-x-4">
                        <button type="button" onclick="window.location.href='/publisher/dashboard'"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit"
                            class="bg-indigo-600 px-4 py-2 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            Start Auction
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

<script>
const form = document.querySelector('form');
const imageInput1 = document.getElementById('itemImage');
const previewContainer1 = document.getElementById('imagePreviewContainer1');
const preview1 = document.getElementById('imagePreview1');
const imageInput2 = document.getElementById('authenticationImage');
const previewContainer2 = document.getElementById('imagePreviewContainer2');
const preview2 = document.getElementById('imagePreview2');
const startDateInput = document.getElementById('auctionStart');
const endDateInput = document.getElementById('auctionEnd');

// Set minimum date/time dynamically
const now = new Date();
const localISOTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
  .toISOString().slice(0, 16);
startDateInput.min = localISOTime;
endDateInput.min = localISOTime;

// Update end date dynamically
startDateInput.addEventListener('change', () => {
  endDateInput.min = startDateInput.value;
  if (endDateInput.value && endDateInput.value <= startDateInput.value) {
    endDateInput.value = '';
  }
});

// Helper: Show dynamic inline error
function showError(input, message) {
  clearError(input);
  const error = document.createElement('p');
  error.className = 'text-red-500 text-xs mt-1 error-msg';
  error.textContent = message;
  input.classList.add('border-red-500');
  input.parentNode.appendChild(error);
}

function clearError(input) {
  input.classList.remove('border-red-500');
  const existing = input.parentNode.querySelector('.error-msg');
  if (existing) existing.remove();
}

function validateForm() {
  let isValid = true;

  if (form.title.value.trim().length < 3) {
    showError(form.title, 'Book title must be at least 3 characters.');
    isValid = false;
  } else clearError(form.title);

  if (form.author.value.trim().length < 3) {
    showError(form.author, 'Author name must be at least 3 characters.');
    isValid = false;
  } else clearError(form.author);

  if (form.description.value.trim().length < 10) {
    showError(form.description, 'Description must be at least 10 characters.');
    isValid = false;
  } else clearError(form.description);

  if (!form.genre.value) {
    showError(form.genre, 'Please select a genre.');
    isValid = false;
  } else clearError(form.genre);

  if (!form.condition.value) {
    showError(form.condition, 'Please select a condition.');
    isValid = false;
  } else clearError(form.condition);

  if (form.basePrice.value <= 0) {
    showError(form.basePrice, 'Base price must be greater than 0.');
    isValid = false;
  } else clearError(form.basePrice);

  if (!imageInput1.files.length) {
    showError(imageInput1.closest('div'), 'Please upload an item image.');
    isValid = false;
  } else clearError(imageInput1.closest('div'));

  if (!imageInput2.files.length) {
    showError(imageInput2.closest('div'), 'Please upload an authentication image.');
    isValid = false;
  } else clearError(imageInput2.closest('div'));

  if (!startDateInput.value || !endDateInput.value) {
    alert('Please select both auction start and end dates.');
    isValid = false;
  } else if (endDateInput.value <= startDateInput.value) {
    alert('Auction end date must be after the start date.');
    isValid = false;
  }

  return isValid;
}

// Live validation
form.querySelectorAll('input, textarea, select').forEach(input => {
  input.addEventListener('input', () => clearError(input));
});

// Dynamic image previews
imageInput1.addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = ev => {
      preview1.src = ev.target.result;
      previewContainer1.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
    clearError(imageInput1.closest('div'));
  } else previewContainer1.classList.add('hidden');
});

imageInput2.addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = ev => {
      preview2.src = ev.target.result;
      previewContainer2.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
    clearError(imageInput2.closest('div'));
  } else previewContainer2.classList.add('hidden');
});

// Submit handler with button disable and text change
form.addEventListener('submit', async e => {
  e.preventDefault();
  if (!validateForm()) return;

  const submitButton = form.querySelector('button[type="submit"]');
  const originalText = submitButton.textContent;
  submitButton.disabled = true;
  submitButton.textContent = 'Starting...';

  const formData = new FormData(form);

  try {
    const response = await fetch('/publisher/sell-antique', {
      method: 'POST',
      body: formData
    });

    if (response.ok) {
      alert('Auction created successfully!');
      window.location.href = '/publisher/dashboard';
    } else {
      const errorText = await response.text();
      alert('Failed to create auction. ' + errorText);
      submitButton.disabled = false;
      submitButton.textContent = originalText;
    }
  } catch (err) {
    console.error(err);
    alert('Error submitting form. Please try again.');
    submitButton.disabled = false;
    submitButton.textContent = originalText;
  }
});
</script>

</body>
</html>
